{"version":3,"file":"index.js","mappings":"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","sources":["webpack://@browser-scan/scanner/webpack/universalModuleDefinition","webpack://@browser-scan/scanner/./api/fileScanner.ts","webpack://@browser-scan/scanner/./api/streamScanner.ts","webpack://@browser-scan/scanner/./api/utils.ts","webpack://@browser-scan/scanner/external node-commonjs \"fs\"","webpack://@browser-scan/scanner/external node-commonjs \"path\"","webpack://@browser-scan/scanner/external umd {\"root\":\"doiuse\",\"umd\":\"doiuse\",\"commonjs\":\"doiuse\",\"commonjs2\":\"doiuse\"}","webpack://@browser-scan/scanner/external umd {\"root\":\"postcss\",\"umd\":\"postcss\",\"commonjs\":\"postcss\",\"commonjs2\":\"postcss\"}","webpack://@browser-scan/scanner/external umd {\"root\":\"postcss-less\",\"umd\":\"postcss-less\",\"commonjs\":\"postcss-less\",\"commonjs2\":\"postcss-less\"}","webpack://@browser-scan/scanner/webpack/bootstrap","webpack://@browser-scan/scanner/./api/index.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"doiuse\"), require(\"postcss\"), require(\"postcss-less\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([, , ], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"@browser-scan/scanner\"] = factory(require(\"doiuse\"), require(\"postcss\"), require(\"postcss-less\"));\n\telse\n\t\troot[\"@browser-scan/scanner\"] = factory(root[\"doiuse\"], root[\"postcss\"], root[\"postcss-less\"]);\n})(this, (__WEBPACK_EXTERNAL_MODULE__338__, __WEBPACK_EXTERNAL_MODULE__236__, __WEBPACK_EXTERNAL_MODULE__731__) => {\nreturn ","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.scanFile = void 0;\nconst doiuse_1 = __importDefault(require(\"doiuse\"));\nconst postcss_1 = __importDefault(require(\"postcss\"));\nconst utils_1 = require(\"./utils\");\nconst postcss_less_1 = __importDefault(require(\"postcss-less\"));\nconst fs_1 = require(\"fs\");\nconst scanFile = ({ params, done, error, }) => __awaiter(void 0, void 0, void 0, function* () {\n    try {\n        const { file, browser, version } = params;\n        const processingOptions = {\n            from: undefined,\n        };\n        const scanned_result = {\n            [file]: [],\n        };\n        const fileContents = (0, fs_1.readFileSync)(file);\n        const plugins = [\n            (0, doiuse_1.default)({\n                browsers: [`${browser} ${version}`],\n                ignore: [\"rem\"],\n                onFeatureUsage: function (usageInfo) {\n                    const message = (0, utils_1.parse_result)(usageInfo.message);\n                    scanned_result[file].push(message);\n                },\n            }),\n        ];\n        if (file.endsWith(\".less\")) {\n            processingOptions[\"syntax\"] = postcss_less_1.default;\n        }\n        yield (0, postcss_1.default)(plugins)\n            .process(fileContents.toString(), processingOptions)\n            .catch((e) => {\n            console.log(e);\n            error(\"error occured while parsing =>\" +\n                file +\n                \"=> this file will be discarded\");\n        });\n        done({\n            scanned_result,\n        });\n    }\n    catch (e) {\n        error(e);\n    }\n});\nexports.scanFile = scanFile;\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.scanFilesInChunks = void 0;\nconst path_1 = require(\"path\");\nconst fs_1 = require(\"fs\");\nconst doiuse_1 = __importDefault(require(\"doiuse\"));\nconst utils_1 = require(\"./utils\");\nconst postcss_1 = __importDefault(require(\"postcss\"));\nconst postcss_less_1 = __importDefault(require(\"postcss-less\"));\nconst getFilesRecursively = (dir, scanning_promises, resolveFile) => __awaiter(void 0, void 0, void 0, function* () {\n    let files = yield fs_1.promises.readdir(dir, { withFileTypes: true });\n    for (const f of files) {\n        const full_path = (0, path_1.join)(dir, f.name);\n        if (!f.name.match(/node_modules/) && !f.name.match(/git/)) {\n            if (f.isDirectory()) {\n                yield getFilesRecursively(full_path, scanning_promises, resolveFile);\n            }\n            if ((f.isFile() && f.name.endsWith(\".css\")) ||\n                f.name.endsWith(\".scss\") ||\n                f.name.endsWith(\".less\")) {\n                scanning_promises.push(resolveFile(full_path));\n            }\n        }\n    }\n    return scanning_promises;\n});\nconst scanFilesInChunks = ({ params, stream, done, error, }) => __awaiter(void 0, void 0, void 0, function* () {\n    try {\n        const scanned_result = {};\n        const { browser, version, path } = params;\n        console.info(\"Scanning files...\");\n        const resolveFile = (file) => {\n            return new Promise((resolve) => {\n                if (!scanned_result[file]) {\n                    scanned_result[file] = [];\n                }\n                const plugins = [\n                    (0, doiuse_1.default)({\n                        browsers: [`${browser} ${version}`],\n                        ignore: [\"rem\"],\n                        onFeatureUsage: function (usageInfo) {\n                            const message = (0, utils_1.parse_result)(usageInfo.message);\n                            scanned_result[file].push(message);\n                        },\n                    }),\n                ];\n                (0, fs_1.readFile)(file, (err, content) => {\n                    if (err) {\n                        error(err);\n                        resolve(file);\n                    }\n                    const processOptions = {\n                        from: undefined,\n                    };\n                    if (file.endsWith(\"less\")) {\n                        processOptions[\"syntax\"] = postcss_less_1.default;\n                    }\n                    (0, postcss_1.default)(plugins)\n                        .process(content.toString(), processOptions)\n                        .catch(() => {\n                        error(\"error occured while parsing =>\" +\n                            file +\n                            \"=> this file will be discarded\");\n                        resolve(file);\n                    })\n                        .then(() => {\n                        if (scanned_result[file].length) {\n                            stream({ [file]: scanned_result[file] });\n                        }\n                        resolve(file);\n                    });\n                });\n            });\n        };\n        const scanning_promises = yield getFilesRecursively(path, [], resolveFile);\n        yield Promise.all(scanning_promises);\n        console.info(\"Scanning Complete\");\n        done({\n            scanned_result,\n        });\n    }\n    catch (e) {\n        error(e);\n    }\n});\nexports.scanFilesInChunks = scanFilesInChunks;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.parse_result = void 0;\nconst parse_result = (message) => {\n    const [_, line_num, col_num, ...rest] = message.split(\":\");\n    return [`${line_num}:${col_num}`, rest.join(\"\")];\n};\nexports.parse_result = parse_result;\n","module.exports = require(\"fs\");","module.exports = require(\"path\");","module.exports = __WEBPACK_EXTERNAL_MODULE__338__;","module.exports = __WEBPACK_EXTERNAL_MODULE__236__;","module.exports = __WEBPACK_EXTERNAL_MODULE__731__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.scanFile = exports.scanFilesInChunks = void 0;\nvar streamScanner_1 = require(\"./streamScanner\");\nObject.defineProperty(exports, \"scanFilesInChunks\", { enumerable: true, get: function () { return streamScanner_1.scanFilesInChunks; } });\nvar fileScanner_1 = require(\"./fileScanner\");\nObject.defineProperty(exports, \"scanFile\", { enumerable: true, get: function () { return fileScanner_1.scanFile; } });\n"],"names":["root","factory","exports","module","require","define","amd","this","__WEBPACK_EXTERNAL_MODULE__338__","__WEBPACK_EXTERNAL_MODULE__236__","__WEBPACK_EXTERNAL_MODULE__731__","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","__importDefault","mod","__esModule","Object","defineProperty","scanFile","doiuse_1","postcss_1","utils_1","postcss_less_1","fs_1","params","error","file","browser","version","processingOptions","from","undefined","scanned_result","fileContents","readFileSync","plugins","default","browsers","ignore","onFeatureUsage","usageInfo","message","parse_result","push","endsWith","process","toString","catch","console","log","scanFilesInChunks","path_1","getFilesRecursively","dir","scanning_promises","resolveFile","files","promises","readdir","withFileTypes","f","full_path","join","name","match","isDirectory","isFile","stream","path","info","readFile","err","content","processOptions","length","all","_","line_num","col_num","rest","split","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","call","streamScanner_1","enumerable","get","fileScanner_1"],"sourceRoot":""}